<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿè—¥ç½²é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢å·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #27ae60; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: var(--primary-color); text-align: center; margin-bottom: 30px; }
        .search-section { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        input[type="text"] { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; min-width: 250px; }
        input[type="number"] { width: 100px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; }
        .weight-label { display: flex; align-items: center; gap: 5px; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th { background-color: var(--primary-color); color: white; padding: 12px; text-align: left; position: sticky; top: 0; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f1f8f5; }
        
        .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; background: #e0e0e0; margin-bottom: 4px; }
        .status { text-align: center; color: #666; margin-top: 10px; }
        .kcal { font-weight: bold; color: #e67e22; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ é£Ÿå“ç‡Ÿé¤Šæˆåˆ†æŸ¥è©¢ç³»çµ±</h1>
    
    <div class="search-section">
        <input type="text" id="searchInput" placeholder="è¼¸å…¥é£Ÿç‰©åç¨±ï¼ˆä¾‹ï¼šé›èƒ¸è‚‰, é®®ä¹³...ï¼‰" disabled>
        <div class="weight-label">
            è¨ˆç®—é‡é‡ï¼š<input type="number" id="weightInput" value="100" min="1"> g
        </div>
    </div>

    <div id="status" class="status">æ­£åœ¨è®€å–è³‡æ–™åº«...</div>

    <div style="overflow-x: auto;">
        <table id="resultTable" style="display: none;">
            <thead>
                <tr>
                    <th>é£Ÿç‰©åç¨± / åˆ†é¡</th>
                    <th>ç†±é‡ (kcal)</th>
                    <th>è›‹ç™½è³ª (g)</th>
                    <th>è„‚è‚ª (g)</th>
                    <th>ç¢³æ°´ (g)</th>
                    <th>ç³– (g)</th>
                    <th>éˆ‰ (mg)</th>
                    <th>è†³é£Ÿçº–ç¶­ (g)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = [];
    const csvFileName = 'é£Ÿå“ç‡Ÿé¤Šæˆåˆ†è³‡æ–™åº«2024UPDATE2.csv'; // ç¢ºä¿æª”æ¡ˆåç¨±ä¸€è‡´

    // åˆå§‹åŒ–è®€å–æª”æ¡ˆ
    Papa.parse(csvFileName, {
        download: true,
        header: true,
        skipEmptyLines: true,
        beforeFirstChunk: function(chunk) {
            // è·³éé£Ÿè—¥ç½²æª”æ¡ˆçš„ç¬¬ä¸€è¡Œèªªæ˜æ–‡å­—
            let lines = chunk.split(/\r\n|\r|\n/);
            lines.shift(); 
            return lines.join('\n');
        },
        complete: function(results) {
            db = results.data;
            document.getElementById('status').innerText = `è³‡æ–™è¼‰å…¥æˆåŠŸï¼å…± ${db.length} ç­†é£Ÿå“è³‡æ–™ã€‚`;
            document.getElementById('searchInput').disabled = false;
        },
        error: function(err) {
            document.getElementById('status').innerText = "éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° CSV æª”æ¡ˆï¼Œè«‹ç¢ºèªæª”åæ˜¯å¦æ­£ç¢ºã€‚";
            console.error(err);
        }
    });

    const searchInput = document.getElementById('searchInput');
    const weightInput = document.getElementById('weightInput');
    const resultTable = document.getElementById('resultTable');
    const resultBody = document.getElementById('resultBody');

    function updateSearch() {
        const keyword = searchInput.value.trim().toLowerCase();
        const weight = parseFloat(weightInput.value) || 100;
        const ratio = weight / 100;

        if (keyword.length < 1) {
            resultTable.style.display = 'none';
            return;
        }

        const filtered = db.filter(item => 
            (item['æ¨£å“åç¨±'] && item['æ¨£å“åç¨±'].toLowerCase().includes(keyword)) ||
            (item['ä¿—å'] && item['ä¿—å'].toLowerCase().includes(keyword))
        ).slice(0, 50); // æœ€å¤šé¡¯ç¤º 50 ç­†é¿å…ç•¶æ©Ÿ

        if (filtered.length > 0) {
            resultTable.style.display = 'table';
            resultBody.innerHTML = filtered.map(item => {
                const kcal = (parseFloat(item['ç†±é‡(kcal)']) * ratio).toFixed(1);
                const protein = (parseFloat(item['ç²—è›‹ç™½(g)']) * ratio).toFixed(1);
                const fat = (parseFloat(item['ç²—è„‚è‚ª(g)']) * ratio).toFixed(1);
                const carb = (parseFloat(item['ç¸½ç¢³æ°´åŒ–åˆç‰©(g)']) * ratio).toFixed(1);
                const sugar = (parseFloat(item['ç³–è³ªç¸½é‡(g)']) * ratio || 0).toFixed(1);
                const sodium = (parseFloat(item['éˆ‰(mg)']) * ratio).toFixed(0);
                const fiber = (parseFloat(item['è†³é£Ÿçº–ç¶­(g)']) * ratio || 0).toFixed(1);

                return `
                    <tr>
                        <td>
                            <span class="badge">${item['é£Ÿå“åˆ†é¡'] || 'æœªçŸ¥'}</span><br>
                            <strong>${item['æ¨£å“åç¨±']}</strong>
                        </td>
                        <td class="kcal">${kcal}</td>
                        <td>${protein}</td>
                        <td>${fat}</td>
                        <td>${carb}</td>
                        <td>${sugar}</td>
                        <td>${sodium}</td>
                        <td>${fiber}</td>
                    </tr>
                `;
            }).join('');
        } else {
            resultTable.style.display = 'none';
        }
    }

    searchInput.addEventListener('input', updateSearch);
    weightInput.addEventListener('input', updateSearch);
</script>

</body>
</html>