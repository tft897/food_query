<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿè—¥ç½²é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f8f9fa; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        .search-section { display: flex; gap: 10px; margin: 20px 0; }
        input { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background-color: #2c3e50; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f1f8f5; }
        .status { font-size: 14px; color: #666; text-align: center; margin-bottom: 10px; }
        .kcal { font-weight: bold; color: #d35400; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</h1>
    <div id="status" class="status">æ­£åœ¨è®€å–è³‡æ–™ä¸­ï¼Œè«‹ç¨å€™...</div>
    <div class="search-section">
        <input type="text" id="searchInput" placeholder="è«‹è¼¸å…¥é—œéµå­—ï¼ˆä¾‹å¦‚ï¼šé›èƒ¸è‚‰ã€å¥¶ç²‰ï¼‰" disabled>
    </div>
    <div style="overflow-x: auto;">
        <table id="resultTable" style="display: none;">
            <thead>
                <tr>
                    <th>é£Ÿç‰©åç¨±</th>
                    <th>ç†±é‡(kcal)</th>
                    <th>è›‹ç™½è³ª(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>ç¢³æ°´(g)</th>
                    <th>éˆ‰(mg)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = [];
    // ç¢ºä¿æª”åèˆ‡ GitHub ä¸Šå®Œå…¨ä¸€è‡´
    const csvFileName = 'é£Ÿå“ç‡Ÿé¤Šæˆåˆ†è³‡æ–™åº«2024UPDATE2.csv';

    Papa.parse(csvFileName, {
        download: true,
        header: false, // æ”¹ç‚º false æ‰‹å‹•è™•ç†
        complete: function(results) {
            const rawData = results.data;
            // é—œéµä¿®æ­£ï¼šæ‰¾åˆ°çœŸæ­£å«æœ‰ã€Œæ¨£å“åç¨±ã€çš„é‚£ä¸€è¡Œä½œç‚ºæ¨™é¡Œ
            let headerIndex = rawData.findIndex(row => row.includes("æ¨£å“åç¨±"));
            
            if (headerIndex !== -1) {
                const headers = rawData[headerIndex];
                const dataRows = rawData.slice(headerIndex + 1);
                
                // å°‡é™£åˆ—è½‰ç‚ºç‰©ä»¶æ ¼å¼
                db = dataRows.map(row => {
                    let obj = {};
                    headers.forEach((header, i) => {
                        obj[header.trim()] = row[i];
                    });
                    return obj;
                });

                document.getElementById('status').innerText = `âœ… è¼‰å…¥æˆåŠŸï¼å…± ${db.length} ç­†è³‡æ–™ã€‚`;
                document.getElementById('searchInput').disabled = false;
            } else {
                document.getElementById('status').innerText = "âŒ æ ¼å¼éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°æ¨™é¡Œåˆ—";
            }
        },
        error: function() {
            document.getElementById('status').innerText = "âŒ è®€å–å¤±æ•—ï¼šè«‹æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚";
        }
    });

    document.getElementById('searchInput').addEventListener('input', function(e) {
        const keyword = e.target.value.trim().toLowerCase();
        const resultTable = document.getElementById('resultTable');
        const resultBody = document.getElementById('resultBody');

        if (!keyword) {
            resultTable.style.display = 'none';
            return;
        }

        const filtered = db.filter(item => 
            item['æ¨£å“åç¨±'] && item['æ¨£å“åç¨±'].toLowerCase().includes(keyword)
        ).slice(0, 50);

        if (filtered.length > 0) {
            resultTable.style.display = 'table';
            resultBody.innerHTML = filtered.map(item => `
                <tr>
                    <td><strong>${item['æ¨£å“åç¨±']}</strong></td>
                    <td class="kcal">${item['ç†±é‡(kcal)'] || '0'}</td>
                    <td>${item['ç²—è›‹ç™½(g)'] || '0'}</td>
                    <td>${item['ç²—è„‚è‚ª(g)'] || '0'}</td>
                    <td>${item['ç¸½ç¢³æ°´åŒ–åˆç‰©(g)'] || '0'}</td>
                    <td>${item['éˆ‰(mg)'] || '0'}</td>
                </tr>
            `).join('');
        } else {
            resultTable.style.display = 'none';
        }
    });
</script>
</body>
</html>
